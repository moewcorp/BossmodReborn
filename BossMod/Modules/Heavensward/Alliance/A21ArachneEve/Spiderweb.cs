namespace BossMod.Heavensward.Alliance.A21ArachneEve;

[SkipLocalsInit]
sealed class SpiderWeb(BossModule module) : BossComponent(module)
{
    private readonly bool[] isSpiderWebArena = new bool[PartyState.MaxAllianceSize];

    public override void DrawArenaBackground(int pcSlot, Actor pc)
    {
        if (pc.Position.InCircle(new(16f, -55f), 30f))
        {
            var y = pc.PosRot.Y;
            var status = isSpiderWebArena[pcSlot];
            if (!status && y > 10f)
            {
                BuildSpiderweb();
                SetArenaStatus(pcSlot, true);
            }
            else if (status && y < 10f)
            {
                var arena = A21ArachneEve.BuildArena();
                Arena.Bounds = arena.arena;
                Arena.Center = arena.center;
                SetArenaStatus(pcSlot, false);
            }
        }
    }

    private void SetArenaStatus(int slot, bool status) => isSpiderWebArena[slot] = status;

    private void BuildSpiderweb()
    {
        // extracted from collision data - material ID: 0002700A
        WPos[] verticesHole1 = [new(29.48507f, -81.26209f), new(33.57198f, -79.1205f), new(36.32985f, -76.86601f), new(36.56158f, -75.94496f),
        new(36.45509f, -75.44612f), new(36.0412f, -74.96638f), new(35.21034f, -74.77068f), new(33.41146f, -75.28911f), new(31.02655f, -76.18025f),
        new(28.36747f, -77.232f), new(24.73944f, -78.52534f), new(21.79821f, -80.24445f), new(21.38703f, -80.93793f), new(21.71251f, -81.70696f),
        new(22.38972f, -82.2739f), new(23.33357f, -82.7226f), new(25.43053f, -83.08634f)];
        WPos[] verticesHole2 = [new(23.62755f, -75.15345f), new(26.27999f, -74.10455f), new(28.04134f, -73.15088f), new(29.18987f, -72.29927f),
        new(29.56259f, -71.30121f), new(29.43666f, -70.76498f), new(28.36504f, -69.95212f), new(26.51486f, -69.94254f), new(24.80286f, -70.27586f),
        new(21.72326f, -71.18345f), new(20.13686f, -71.73169f), new(19.3025f, -72.23955f), new(18.29037f, -73.05447f), new(17.90116f, -73.95057f),
        new(17.87919f, -74.52419f), new(18.29808f, -75.19415f), new(19.03847f, -75.65262f), new(20.67557f, -75.83903f)];
        WPos[] verticesHole3 = [new(6.19481f, -53.0172f), new(6.68025f, -52.60915f), new(7.12203f, -52.03413f), new(7.90971f, -50.38101f),
        new(7.92672f, -49.46964f), new(7.69205f, -48.51882f), new(4.68721f, -45.18468f), new(3.031f, -43.77811f), new(2.01715f, -43.89301f),
        new(1.50148f, -44.60635f), new(0.79936f, -46.60518f), new(0.09659f, -48.87369f), new(-0.26234f, -50.78598f), new(-0.44492f, -52.24662f),
        new(-0.38146f, -52.77901f), new(0.26328f, -53.3029f), new(2.07089f, -53.34706f)];
        WPos[] verticesHole4 = [new(13.41816f, -68.73041f), new(14.13574f, -68.17189f), new(14.19972f, -64.8876f), new(13.31054f, -64.36171f),
        new(11.53195f, -63.488f), new(10.8016f, -63.39225f), new(10.08654f, -63.55973f), new(9.39704f, -64.19978f), new(7.68186f, -65.79169f),
        new(6.9832f, -66.36708f), new(7.09283f, -67.09574f), new(7.59882f, -67.69183f), new(8.61034f, -68.51662f), new(10.83712f, -69.1035f)];
        WPos[] verticesHole5 = [new(18.03738f, -83.51598f), new(18.29612f, -82.93386f), new(18.35019f, -82.31193f), new(17.66512f, -81.26018f),
        new(16.4022f, -80.6261f), new(14.00532f, -79.71832f), new(11.00586f, -79.05625f), new(7.55171f, -78.42128f), new(3.80481f, -77.57981f),
        new(0.68394f, -76.94022f), new(0.17645f, -76.94545f), new(0.13365f, -76.95671f), new(-0.36711f, -77.08798f), new(-0.82656f, -77.32098f),
        new(-1.13699f, -77.47836f), new(-1.40522f, -78.25651f), new(-1.16358f, -78.95003f), new(-0.67497f, -79.9422f), new(2.52903f, -81.91533f),
        new(5.33965f, -82.9498f), new(11.99411f, -84.13968f), new(16.09429f, -84.50619f)];
        WPos[] verticesHole6 = [new(-0.55429f, -69.03259f), new(0.75913f, -68.39395f), new(2.19304f, -67.23718f), new(3.53055f, -65.80328f),
        new(5.03676f, -63.98377f), new(7.57925f, -61.38104f), new(7.20571f, -59.91098f), new(6.69962f, -58.33248f), new(6.12123f, -57.52515f),
        new(5.32596f, -56.77807f), new(4.09689f, -56.77807f), new(1.90385f, -56.77807f), new(0.03615f, -56.71782f), new(-4.31378f, -57.42875f),
        new(-5.30186f, -57.89869f), new(-5.92844f, -58.82652f), new(-5.85614f, -59.62179f), new(-5.56695f, -60.44117f), new(-5.00062f, -62.81496f),
        new(-4.25354f, -65.24899f), new(-3.03652f, -67.46613f), new(-1.7472f, -69.17719f)];
        WPos[] verticesHole7 = [new(17.95751f, -62.29311f), new(20.00457f, -61.21575f), new(21.4054f, -59.8881f), new(22.27112f, -58.67171f),
        new(22.81146f, -56.97883f), new(23.09245f, -55.49365f), new(22.89127f, -54.33657f), new(22.54701f, -52.86009f), new(22.15154f, -51.89862f),
        new(21.71779f, -51.30052f), new(21.28764f, -50.79925f), new(20.08836f, -49.92268f), new(19.65765f, -49.53562f), new(19.16866f, -49.22641f),
        new(17.81134f, -48.58396f), new(16.84123f, -48.45672f), new(15.47881f, -48.26877f), new(14.2192f, -48.61317f), new(12.63781f, -49.1937f),
        new(11.74704f, -49.73707f), new(10.86511f, -50.71078f), new(10.06542f, -51.66642f), new(9.23334f, -53.29472f), new(9.1689f, -54.5577f),
        new(8.95067f, -56.20993f), new(8.93969f, -56.81588f), new(9.09497f, -57.45697f), new(9.71457f, -58.60302f), new(10.59823f, -59.72146f),
        new(11.90532f, -61.20556f), new(12.52795f, -61.57944f), new(14.34341f, -62.26699f), new(15.31787f, -62.51774f)];
        WPos[] verticesHole8 = [new(13.27619f, -45.989f), new(14.66749f, -44.675f), new(14.96459f, -42.08101f), new(14.86473f, -40.56705f),
        new(14.34911f, -39.9519f), new(13.58718f, -39.78414f), new(13.58718f, -39.78413f), new(13.57568f, -39.78161f), new(10.50846f, -39.83671f),
        new(8.27874f, -40.28971f), new(6.36959f, -40.68803f), new(5.20647f, -41.25679f), new(4.85291f, -42.08424f), new(6.02504f, -43.31903f),
        new(9.18404f, -46.3362f), new(10.99834f, -46.73088f)];
        WPos[] verticesHole9 = [new(5.7341f, -38.62906f), new(7.90364f, -38.17106f), new(7.92827f, -38.16639f), new(10.20565f, -37.71469f),
        new(10.24023f, -37.70427f), new(13.11628f, -36.83757f), new(13.17521f, -36.81968f), new(14.12476f, -36.15298f), new(14.96871f, -35.25113f),
        new(15.25801f, -34.12961f), new(15.21736f, -32.61691f), new(14.3943f, -31.64035f), new(11.48288f, -31.65007f), new(7.88686f, -32.51163f),
        new(4.21935f, -34.19293f), new(1.95846f, -35.71161f), new(1.33961f, -36.44256f), new(1.01909f, -37.19524f), new(1.1333f, -38.0983f),
        new(1.66864f, -38.83594f), new(2.92418f, -38.915f)];
        WPos[] verticesHole10 = [new(20.97268f, -69.23686f), new(22.82389f, -68.71915f), new(24.1548f, -68.15034f), new(25.47745f, -67.52729f),
        new(25.92284f, -66.68218f), new(24.66883f, -65.44809f), new(22.34047f, -63.53819f), new(21.1767f, -63.75492f), new(19.19988f, -64.57951f),
        new(18.01457f, -65.28757f), new(17.56106f, -68.94611f), new(18.4207f, -69.35201f), new(19.53283f, -69.50327f)];
        WPos[] verticesHole11 = [new(34.59402f, -68.57536f), new(36.467f, -65.96165f), new(37.82283f, -63.18028f), new(38.75687f, -60.75443f),
        new(39.33754f, -58.13899f), new(39.15089f, -56.68181f), new(37.88876f, -56.5919f), new(36.64598f, -57.6637f), new(35.54044f, -59.78525f),
        new(34.2777f, -61.93203f), new(34.25639f, -61.96848f), new(33.1787f, -64.18408f), new(32.11718f, -66.8076f), new(32.13195f, -68.14362f),
        new(32.45934f, -68.87069f), new(33.5024f, -69.34187f)];
        WPos[] verticesHole12 = [new(37.90993f, -52.65644f), new(38.11298f, -50.74429f), new(37.23459f, -48.38181f), new(35.9347f, -45.79119f),
        new(34.74098f, -43.42637f), new(33.40324f, -41.80703f), new(32.73795f, -41.60151f), new(32.53719f, -41.62731f), new(32.07307f, -41.70946f),
        new(31.19716f, -42.15395f), new(30.93304f, -42.80916f), new(30.89907f, -43.41623f), new(31.26338f, -44.95738f), new(33.78007f, -50.39676f),
        new(34.90468f, -52.38961f), new(36.70635f, -53.25127f)];
        WPos[] verticesHole13 = [new(13.20885f, -76.13025f), new(13.78074f, -75.54178f), new(14.12472f, -74.79699f), new(14.06004f, -74.13282f),
        new(13.69527f, -73.56412f), new(13.09717f, -73.17397f), new(12.44991f, -72.93163f), new(10.38538f, -72.39928f), new(7.2397f, -71.5442f),
        new(4.31916f, -71.01233f), new(3.68064f, -71.05686f), new(3.15876f, -71.20747f), new(2.50968f, -71.50397f), new(1.89761f, -72.15763f),
        new(1.56845f, -73.11817f), new(1.6577f, -73.64683f), new(2.07612f, -74.10927f), new(4.79389f, -75.06709f), new(7.77705f, -75.75912f),
        new(11.00605f, -76.25067f), new(12.17808f, -76.25707f)];
        WPos[] verticesHole14 = [new(29.04188f, -63.80403f), new(30.82884f, -62.58877f), new(31.95396f, -60.90733f), new(32.52299f, -59.22178f),
        new(32.93393f, -57.61426f), new(32.55878f, -56.86962f), new(31.9398f, -56.22176f), new(29.2517f, -56.12558f), new(25.79068f, -56.24956f),
        new(25.08155f, -57.64095f), new(24.55061f, -59.33435f), new(24.3035f, -60.8227f), new(27.93139f, -64.10937f)];
        WPos[] verticesHole15 = [new(-0.19014f, -32.82215f), new(-0.16f, -32.80524f), new(2.93208f, -31.44207f), new(2.96722f, -31.42843f),
        new(6.72777f, -29.96695f), new(6.77749f, -29.94765f), new(10.23855f, -28.7508f), new(10.30491f, -28.72785f), new(13.20778f, -27.76825f),
        new(14.67052f, -27.01286f), new(14.70599f, -26.99305f), new(14.9266f, -26.60206f), new(14.89361f, -26.13504f), new(14.44248f, -25.76237f),
        new(13.55456f, -25.4146f), new(8.15294f, -26.31901f), new(8.04986f, -26.33621f), new(8.02093f, -26.34738f), new(4.81969f, -27.57643f),
        new(4.78787f, -27.58965f), new(2.20211f, -28.65781f), new(2.12696f, -28.70197f), new(-1.44354f, -30.79458f), new(-1.48854f, -30.83631f),
        new(-3.37774f, -32.58411f), new(-3.50802f, -33.43235f), new(-3.11082f, -33.86578f), new(-2.48207f, -34.10209f)];
        WPos[] verticesHole16 = [new(44.48826f, -51.09668f), new(44.73149f, -50.38662f), new(44.98304f, -48.74014f), new(44.2504f, -45.62632f),
        new(43.01799f, -42.80159f), new(41.86825f, -40.537f), new(39.99689f, -37.72722f), new(38.71593f, -37.23221f), new(38.18508f, -37.18277f),
        new(36.99795f, -38.10886f), new(36.77701f, -38.6879f), new(36.75037f, -39.29169f), new(37.5788f, -41.55161f), new(38.60939f, -44.28265f),
        new(39.97671f, -47.22295f), new(41.40903f, -49.67539f), new(42.66322f, -51.59043f), new(43.63142f, -51.70343f)];
        WPos[] verticesHole17 = [new(40.02302f, -71.55528f), new(42.1498f, -68.20624f), new(43.94918f, -63.7095f), new(45.37464f, -59.14206f),
        new(45.42352f, -56.24764f), new(45.20758f, -55.33257f), new(44.47508f, -55.01864f), new(43.82367f, -55.08276f), new(42.99627f, -55.79805f),
        new(42.30214f, -57.23454f), new(41.80339f, -59.09009f), new(40.86159f, -61.72997f), new(39.92582f, -63.97389f), new(38.49018f, -67.18761f),
        new(37.87587f, -69.33168f), new(37.79465f, -70.29427f), new(37.98344f, -71.09882f), new(38.5514f, -71.50697f), new(39.13702f, -71.65272f)];
        WPos[] verticesHole18 = [new(21.47199f, -46.46312f), new(22.23046f, -46.1076f), new(24.17378f, -44.65439f), new(25.25142f, -43.62567f),
        new(25.24988f, -42.89771f), new(24.90361f, -42.35966f), new(23.25474f, -40.8135f), new(21.63526f, -39.67553f), new(19.94873f, -38.84631f),
        new(18.73692f, -38.61364f), new(18.25883f, -38.83168f), new(18.0263f, -39.64296f), new(17.93508f, -40.53168f), new(17.79232f, -42.10335f),
        new(17.78405f, -44.78822f), new(18.98646f, -45.75848f), new(20.62599f, -46.60999f)];
        WPos[] verticesHole19 = [new(32.18055f, -53.02523f), new(32.37466f, -52.52448f), new(31.87022f, -50.86472f), new(29.60311f, -46.49878f),
        new(28.60771f, -45.63955f), new(27.98391f, -45.53642f), new(27.29633f, -45.63165f), new(26.19443f, -46.64023f), new(24.31915f, -48.65999f),
        new(24.08929f, -49.50305f), new(24.15681f, -50.42255f), new(24.78963f, -51.86679f), new(24.83089f, -51.90437f), new(26.10527f, -53.06448f),
        new(29.23782f, -53.52665f), new(31.7303f, -53.53132f)];
        WPos[] verticesHole20 = [new(-11.40867f, -54.45414f), new(-10.48206f, -52.78397f), new(-9.90186f, -51.43945f), new(-9.27446f, -49.85666f),
        new(-8.09818f, -46.94154f), new(-6.97698f, -44.03573f), new(-6.34388f, -41.8597f), new(-5.19587f, -38.39396f), new(-5.45592f, -37.26464f),
        new(-5.82443f, -36.91589f), new(-6.245f, -36.77663f), new(-8.29963f, -37.74886f), new(-10.60945f, -41.94451f), new(-12.12962f, -46.05367f),
        new(-13.34115f, -50.98f), new(-13.76905f, -53.87436f), new(-12.74113f, -54.66307f), new(-12.19051f, -54.77233f)];
        WPos[] verticesHole21 = [new(-5.09755f, -74.53175f), new(-5.03395f, -74.10076f), new(-5.01334f, -73.33154f), new(-5.15409f, -72.88853f),
        new(-6.30753f, -69.53178f), new(-7.20087f, -66.86382f), new(-7.20946f, -66.84148f), new(-8.43561f, -63.66141f), new(-9.39629f, -61.18822f),
        new(-9.94925f, -60.11815f), new(-10.74305f, -59.20556f), new(-11.80443f, -58.52017f), new(-12.30991f, -58.46026f), new(-12.65982f, -58.98172f),
        new(-12.91539f, -59.43374f), new(-13.16455f, -60.489f), new(-12.0857f, -64.01357f), new(-10.01542f, -68.07272f), new(-7.84588f, -72.48278f),
        new(-6.17023f, -74.31731f), new(-5.61989f, -74.5826f)];
        WPos[] verticesHole22 = [new(29.66797f, -39.43375f), new(30.2727f, -38.85664f), new(30.55575f, -38.40345f), new(30.62276f, -38.11723f),
        new(29.8548f, -37.04776f), new(28.65477f, -35.97671f), new(25.96494f, -34.27116f), new(22.4636f, -32.27985f), new(19.8012f, -31.20534f),
        new(19.05427f, -31.11866f), new(18.43061f, -31.27983f), new(18.36766f, -31.41245f), new(18.05607f, -32.24022f), new(18.32911f, -32.80239f),
        new(18.73748f, -33.31861f), new(20.50757f, -34.86538f), new(22.90263f, -36.61229f), new(25.30983f, -38.09059f), new(27.86176f, -39.27791f),
        new(28.74253f, -39.49838f)];
        WPos[] verticesHole23 = [new(-4.70156f, -52.80495f), new(-4.01995f, -51.80133f), new(-3.35428f, -50.16264f), new(-2.81577f, -48.35709f),
        new(-1.93532f, -45.33805f), new(-1.28676f, -42.96916f), new(-1.14591f, -42.12484f), new(-1.20007f, -41.50142f), new(-1.46415f, -40.82939f),
        new(-1.94495f, -40.15545f), new(-2.60394f, -40.17134f), new(-3.27022f, -40.56102f), new(-3.61097f, -41.21982f), new(-4.06724f, -42.10194f),
        new(-4.99558f, -44.20648f), new(-6.2522f, -47.47314f), new(-6.25926f, -47.49165f), new(-6.86086f, -49.90652f), new(-7.06432f, -51.32267f),
        new(-7.21993f, -52.0947f), new(-6.69025f, -52.71747f), new(-6.04163f, -52.96902f), new(-5.27157f, -53.01112f)];
        WPos[] verticesHole24 = [new(34.00269f, -34.94641f), new(35.06141f, -34.23148f), new(35.32964f, -33.64647f), new(35.34048f, -32.9451f),
        new(33.53479f, -30.84753f), new(28.26457f, -28.1313f), new(25.28483f, -26.59547f), new(21.92985f, -26.02583f), new(21.08146f, -26.32621f),
        new(20.59122f, -26.63005f), new(20.34149f, -27.13286f), new(20.34518f, -27.74517f), new(20.5407f, -28.31686f), new(21.09787f, -28.82687f),
        new(23.44105f, -30.10924f), new(27.16015f, -32.07288f), new(30.03471f, -33.50787f), new(31.60666f, -34.25779f), new(31.6182f, -34.26331f),
        new(32.96875f, -34.91491f), new(33.61133f, -34.95337f)];

        var arena = new ArenaBoundsCustom([new Polygon(new(16.11796f, -54.92273f), 29.5f, 20)],
        [new PolygonCustom(verticesHole1), new PolygonCustom(verticesHole2), new PolygonCustom(verticesHole3), new PolygonCustom(verticesHole4),
        new PolygonCustom(verticesHole5), new PolygonCustom(verticesHole6), new PolygonCustom(verticesHole7), new PolygonCustom(verticesHole8),
        new PolygonCustom(verticesHole9), new PolygonCustom(verticesHole10), new PolygonCustom(verticesHole11), new PolygonCustom(verticesHole12),
        new PolygonCustom(verticesHole13), new PolygonCustom(verticesHole14), new PolygonCustom(verticesHole15), new PolygonCustom(verticesHole16),
        new PolygonCustom(verticesHole17), new PolygonCustom(verticesHole18), new PolygonCustom(verticesHole19), new PolygonCustom(verticesHole20),
        new PolygonCustom(verticesHole21), new PolygonCustom(verticesHole22), new PolygonCustom(verticesHole23), new PolygonCustom(verticesHole24)]);
        Arena.Bounds = arena;
        Arena.Center = arena.Center;
    }
}
