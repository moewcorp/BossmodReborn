namespace BossMod.Heavensward.Alliance.A24Ozma;

class MeteorImpact(BossModule module) : Components.SimpleAOEs(module, (uint)AID.MeteorImpact, 20);
class HolyKB(BossModule module) : Components.SimpleKnockbacks(module, (uint)AID.Holy, 3);
class Holy(BossModule module) : Components.RaidwideCast(module, (uint)AID.Holy);
class ExecrationAOE(BossModule module) : Components.SimpleAOEs(module, (uint)AID.ExecrationAOE, new AOEShapeRect(40.5f, 5));

class AccelerationBomb(BossModule module) : Components.StayMove(module)
{
    public override void OnStatusGain(Actor actor, ref ActorStatus status)
    {
        if (status.ID == (uint)SID.AccelerationBomb && Raid.FindSlot(actor.InstanceID) is var slot && slot >= 0)
        {
            PlayerStates[slot] = new(Requirement.Stay, status.ExpireAt);
        }
    }

    public override void OnStatusLose(Actor actor, ref ActorStatus status)
    {
        if (status.ID == (uint)SID.AccelerationBomb && Raid.FindSlot(actor.InstanceID) is var slot && slot >= 0)
        {
            PlayerStates[slot] = default;
        }
    }
}

[ModuleInfo(BossModuleInfo.Maturity.WIP, Contributors = "The Combat Reborn Team", GroupType = BossModuleInfo.GroupType.CFC, GroupID = 168u, NameID = 4896u)]
[SkipLocalsInit]
public sealed class A24Ozma : BossModule
{
    public A24Ozma(WorldState ws, Actor primary) : this(ws, primary, BuildArena()) { }

    private A24Ozma(WorldState ws, Actor primary, (WPos center, ArenaBoundsCustom arena) a) : base(ws, primary, a.center, a.arena) { }

    public static (WPos center, ArenaBoundsCustom arena) BuildArena()
    {
        // extracted from collision data - material ID: 00027006 is the visible collision, true collision is material ID: 00005000 - we are using the true collision here
        // the true collision got a larger area so it might be benefitial
        WPos[] verticesInner = [new(279.33658f, -428.48758f), new(279.60031f, -428.32523f), new(280.00012f, -428.24234f), new(280.40009f, -428.32529f),
        new(280.6636f, -428.48758f), new(281.75537f, -428.41602f), new(281.99567f, -428.22061f), new(282.38123f, -428.08627f), new(282.7886f, -428.11627f),
        new(283.07095f, -428.2428f), new(284.14413f, -428.02933f), new(284.35678f, -427.80429f), new(284.72147f, -427.62073f), new(285.12936f, -427.59732f),
        new(285.42578f, -427.68591f), new(286.46182f, -427.33426f), new(286.64337f, -427.08337f), new(286.98114f, -426.85376f), new(287.38226f, -426.77725f),
        new(287.68793f, -426.82642f), new(288.66922f, -426.34247f), new(288.81631f, -426.07001f), new(289.12122f, -425.79831f), new(289.50912f, -425.67023f),
        new(289.81839f, -425.67899f), new(291.28091f, -424.70181f), new(292.44022f, -423.68503f), new(287.75061f, -421.02972f), new(287.75024f, -421.02951f),
        new(287.36853f, -420.3623f), new(287.36508f, -419.59341f), new(289.16483f, -416.58093f), new(288.95398f, -416.15973f), new(289.07291f, -415.23822f),
        new(289.81143f, -414.67468f), new(290.28165f, -414.6467f), new(291.99069f, -411.58151f), new(292.65839f, -411.20016f), new(293.42706f, -411.19696f),
        new(298.07166f, -413.93088f), new(298.37241f, -412.41898f), new(298.48752f, -410.66348f), new(298.32516f, -410.39978f), new(298.24231f, -409.99997f),
        new(298.32529f, -409.59991f), new(298.48752f, -409.33633f), new(298.41595f, -408.2446f), new(298.22049f, -408.00436f), new(298.08624f, -407.6188f),
        new(298.11621f, -407.21146f), new(298.24274f, -406.92896f), new(298.02939f, -405.85605f), new(297.80417f, -405.64325f), new(297.6207f, -405.27844f),
        new(297.59732f, -404.8707f), new(297.68585f, -404.57391f), new(297.3342f, -403.53802f), new(297.08313f, -403.35651f), new(296.85367f, -403.01886f),
        new(296.77725f, -402.61758f), new(296.82623f, -402.3118f), new(296.3425f, -401.33078f), new(296.06989f, -401.18359f), new(295.79825f, -400.87881f),
        new(295.67007f, -400.49094f), new(295.67886f, -400.18134f), new(295.07126f, -399.27197f), new(294.78162f, -399.1615f), new(294.4725f, -398.89471f),
        new(294.2948f, -398.52689f), new(294.26306f, -398.21881f), new(293.54184f, -397.39645f), new(293.24042f, -397.32477f), new(292.89914f, -397.10068f),
        new(292.67493f, -396.75922f), new(292.60336f, -396.45804f), new(291.78085f, -395.73666f), new(291.47278f, -395.70493f), new(291.10504f, -395.52744f),
        new(290.83826f, -395.21814f), new(290.72797f, -394.92883f), new(289.81833f, -394.32111f), new(289.50867f, -394.3298f), new(289.12097f, -394.20175f),
        new(288.81604f, -393.92999f), new(288.66898f, -393.65756f), new(287.09161f, -392.87955f), new(285.63165f, -392.38394f), new(285.677f, -397.77344f),
        new(285.28976f, -398.43765f), new(284.62582f, -398.82507f), new(281.11691f, -398.77261f), new(280.85754f, -399.16583f), new(280.00009f, -399.52365f),
        new(279.14264f, -399.16583f), new(278.88327f, -398.77261f), new(275.37436f, -398.82507f), new(274.7103f, -398.43756f), new(274.32318f, -397.77344f),
        new(274.36853f, -392.38391f), new(272.90857f, -392.87949f), new(271.33081f, -393.6575f), new(271.18353f, -393.93005f), new(270.87872f, -394.20172f),
        new(270.49088f, -394.3299f), new(270.18137f, -394.32111f), new(269.27182f, -394.92886f), new(269.16138f, -395.21832f), new(268.89465f, -395.52744f),
        new(268.52686f, -395.70514f), new(268.21884f, -395.73685f), new(267.39642f, -396.4581f), new(267.32474f, -396.75949f), new(267.10062f, -397.1008f),
        new(266.75916f, -397.32498f), new(266.45798f, -397.39658f), new(265.73669f, -398.21906f), new(265.70493f, -398.52722f), new(265.52728f, -398.89487f),
        new(265.21802f, -399.16168f), new(264.92874f, -399.272f), new(264.32098f, -400.18158f), new(264.32971f, -400.49124f), new(264.2016f, -400.87894f),
        new(263.92981f, -401.18384f), new(263.6572f, -401.33112f), new(263.17346f, -402.31155f), new(263.22266f, -402.61798f), new(263.14621f, -403.01907f),
        new(262.91653f, -403.35687f), new(262.66608f, -403.53799f), new(262.31409f, -404.57434f), new(262.40262f, -404.871f), new(262.37921f, -405.27866f),
        new(262.19559f, -405.64352f), new(261.97055f, -405.85617f), new(261.75711f, -406.92902f), new(261.88373f, -407.21179f), new(261.9137f, -407.61902f),
        new(261.77927f, -408.00473f), new(261.58389f, -408.24493f), new(261.51236f, -409.33649f), new(261.67477f, -409.60031f), new(261.75766f, -410.00012f),
        new(261.67471f, -410.40009f), new(261.51236f, -410.6637f), new(261.62738f, -412.41867f), new(261.92825f, -413.93106f), new(266.57294f, -411.19717f),
        new(267.34155f, -411.20035f), new(268.00909f, -411.58173f), new(269.7182f, -414.64679f), new(270.18851f, -414.67477f), new(270.92706f, -415.23834f),
        new(271.04587f, -416.15976f), new(270.83502f, -416.58099f), new(272.63492f, -419.59354f), new(272.63135f, -420.36243f), new(272.24976f, -421.02972f),
        new(267.55975f, -423.68512f), new(268.71881f, -424.70181f), new(270.18176f, -425.67914f), new(270.49124f, -425.67026f), new(270.87894f, -425.7984f),
        new(271.18384f, -426.07019f), new(271.33096f, -426.3425f), new(272.31219f, -426.82642f), new(272.61798f, -426.77734f), new(273.01907f, -426.85379f),
        new(273.35687f, -427.08347f), new(273.53824f, -427.33423f), new(274.57428f, -427.68594f), new(274.871f, -427.59738f), new(275.27866f, -427.62079f),
        new(275.64352f, -427.80441f), new(275.85608f, -428.02939f), new(276.92914f, -428.24283f), new(277.21182f, -428.11627f), new(277.61902f, -428.0863f),
        new(278.00473f, -428.22073f), new(278.24487f, -428.41605f)];

        WPos[] verticesOuter = [new(305.84766f, -409.42181f), new(305.49316f, -409.03296f), new(305.44751f, -409.02921f), new(305.35654f, -407.64066f),
        new(305.40125f, -407.63098f), new(305.70187f, -407.19907f), new(305.79623f, -406.60382f), new(305.55103f, -406.05301f), new(305.14893f, -405.71371f),
        new(305.10315f, -405.71594f), new(304.8317f, -404.35117f), new(304.87469f, -404.33575f), new(305.11636f, -403.86829f), new(305.13223f, -403.26578f),
        new(304.81729f, -402.75168f), new(304.3743f, -402.46777f), new(304.32916f, -402.47598f), new(303.88184f, -401.15826f), new(303.92252f, -401.13736f),
        new(304.10123f, -400.6424f), new(304.03821f, -400.04297f), new(303.65881f, -399.57443f), new(303.18259f, -399.35074f), new(303.13892f, -399.36475f),
        new(302.5235f, -398.1167f), new(302.561f, -398.09073f), new(302.67365f, -397.57651f), new(302.53287f, -396.99051f), new(302.09558f, -396.57553f),
        new(301.59418f, -396.41599f), new(301.55286f, -396.43552f), new(300.77975f, -395.27853f), new(300.81357f, -395.24786f), new(300.85803f, -394.72336f),
        new(300.64212f, -394.16064f), new(300.15424f, -393.80627f), new(299.63635f, -393.71353f), new(299.59787f, -393.73834f), new(298.68039f, -392.69211f),
        new(298.7099f, -392.65732f), new(298.68558f, -392.13153f), new(298.3981f, -391.60187f), new(297.86813f, -391.31415f), new(297.34253f, -391.28983f),
        new(297.30765f, -391.3194f), new(296.26144f, -390.40195f), new(296.28622f, -390.36349f), new(296.19336f, -389.84537f), new(295.83917f, -389.35788f),
        new(295.27625f, -389.14178f), new(294.75208f, -389.18631f), new(294.72131f, -389.22021f), new(293.56427f, -388.44702f), new(293.58377f, -388.40573f),
        new(293.42419f, -387.90421f), new(293.00928f, -387.46695f), new(292.42303f, -387.32635f), new(291.90915f, -387.43869f), new(291.88306f, -387.47635f),
        new(289.7627f, -386.43069f), new(286.60278f, -385.35803f), new(286.00269f, -385.23868f), new(285.95737f, -385.14789f), new(285.58844f, -385.0285f),
        new(285.677f, -374.50238f), new(285.28992f, -373.83826f), new(284.62582f, -373.45074f), new(281.11691f, -373.5032f), new(280.85754f, -373.10999f),
        new(280.00009f, -372.75217f), new(279.14264f, -373.10999f), new(278.88327f, -373.5032f), new(275.37436f, -373.45074f), new(274.71027f, -373.83826f),
        new(274.32318f, -374.50238f), new(274.41174f, -385.0285f), new(274.04269f, -385.14777f), new(273.99731f, -385.23868f), new(273.39734f, -385.35803f),
        new(270.23734f, -386.43069f), new(268.1167f, -387.47647f), new(268.09067f, -387.43884f), new(267.57654f, -387.32635f), new(266.99048f, -387.46698f),
        new(266.57547f, -387.90436f), new(266.41589f, -388.40573f), new(266.43549f, -388.44717f), new(265.27844f, -389.22028f), new(265.24771f, -389.18637f),
        new(264.7233f, -389.14194f), new(264.16061f, -389.35788f), new(263.80624f, -389.84564f), new(263.71347f, -390.36356f), new(263.73831f, -390.4021f),
        new(262.69211f, -391.31958f), new(262.65723f, -391.28998f), new(262.13147f, -391.31439f), new(261.60178f, -391.6019f), new(261.31412f, -392.13177f),
        new(261.28976f, -392.65735f), new(261.3194f, -392.69229f), new(260.40189f, -393.73853f), new(260.36343f, -393.71375f), new(259.84537f, -393.80655f),
        new(259.35776f, -394.16077f), new(259.14169f, -394.72363f), new(259.18616f, -395.24789f), new(259.22012f, -395.27869f), new(258.44702f, -396.4357f),
        new(258.40564f, -396.41614f), new(257.90414f, -396.57581f), new(257.46692f, -396.99063f), new(257.32617f, -397.57687f), new(257.43869f, -398.09088f),
        new(257.47623f, -398.11688f), new(256.8605f, -399.36487f), new(256.81732f, -399.35098f), new(256.34094f, -399.57474f), new(255.96161f, -400.04309f),
        new(255.89862f, -400.6427f), new(256.07724f, -401.1376f), new(256.11801f, -401.15854f), new(255.67068f, -402.47629f), new(255.62566f, -402.46811f),
        new(255.18259f, -402.75204f), new(254.86763f, -403.26596f), new(254.88342f, -403.86865f), new(255.12512f, -404.33603f), new(255.16827f, -404.35147f),
        new(254.89679f, -405.71625f), new(254.85107f, -405.71402f), new(254.44887f, -406.05338f), new(254.20366f, -406.60394f), new(254.298f, -407.19943f),
        new(254.59863f, -407.63123f), new(254.64343f, -407.6409f), new(254.55241f, -409.02948f), new(254.50681f, -409.03323f), new(254.1523f, -409.42227f),
        new(253.98108f, -410.00009f), new(254.15234f, -410.57816f), new(254.50676f, -410.96704f), new(254.55244f, -410.97079f), new(254.70705f, -413.32974f),
        new(255.35805f, -416.60266f), new(255.55472f, -417.18213f), new(255.49855f, -417.26709f), new(255.57979f, -417.64636f), new(246.4196f, -422.8327f),
        new(246.03802f, -423.5f), new(246.03445f, -424.26889f), new(247.83435f, -427.28143f), new(247.6235f, -427.70267f), new(247.74229f, -428.62408f),
        new(248.48087f, -429.18765f), new(248.9511f, -429.2157f), new(250.66008f, -432.28079f), new(251.32764f, -432.66211f), new(252.09644f, -432.66525f),
        new(261.16803f, -427.32547f), new(261.45578f, -427.58551f), new(261.55756f, -427.57932f), new(261.96078f, -428.03906f), new(264.46964f, -430.23944f),
        new(266.43567f, -431.55304f), new(266.41614f, -431.59436f), new(266.57574f, -432.09586f), new(266.99063f, -432.53311f), new(267.57684f, -432.67383f),
        new(268.09079f, -432.56134f), new(268.11691f, -432.52362f), new(269.36496f, -433.1391f), new(269.35095f, -433.18268f), new(269.57471f, -433.65906f),
        new(270.04303f, -434.03842f), new(270.6427f, -434.10138f), new(271.1376f, -433.92276f), new(271.15854f, -433.88199f), new(272.47623f, -434.32928f),
        new(272.46805f, -434.3743f), new(272.75204f, -434.81741f), new(273.2659f, -435.13235f), new(273.86859f, -435.11655f), new(274.33597f, -434.87488f),
        new(274.35141f, -434.83173f), new(275.71619f, -435.10321f), new(275.71396f, -435.1489f), new(276.05338f, -435.55115f), new(276.60394f, -435.79633f),
        new(277.19943f, -435.702f), new(277.63123f, -435.40137f), new(277.6409f, -435.35657f), new(279.02948f, -435.4476f), new(279.03323f, -435.49319f),
        new(279.42224f, -435.84769f), new(280.00009f, -436.01892f), new(280.57819f, -435.84766f), new(280.96704f, -435.49326f), new(280.97079f, -435.44757f),
        new(282.35934f, -435.35657f), new(282.36902f, -435.40128f), new(282.8009f, -435.70206f), new(283.39618f, -435.79633f), new(283.94702f, -435.55115f),
        new(284.28629f, -435.14902f), new(284.28403f, -435.10315f), new(285.64877f, -434.8317f), new(285.66425f, -434.87488f), new(286.13177f, -435.11655f),
        new(286.73428f, -435.13232f), new(287.24832f, -434.81729f), new(287.53217f, -434.37439f), new(287.52396f, -434.32925f), new(288.84167f, -433.88202f),
        new(288.86258f, -433.92267f), new(289.35757f, -434.10138f), new(289.95706f, -434.03845f), new(290.42548f, -433.659f), new(290.64914f, -433.18265f),
        new(290.63516f, -433.1391f), new(291.88309f, -432.52365f), new(291.90915f, -432.56128f), new(292.42346f, -432.67368f), new(293.00943f, -432.53311f),
        new(293.42441f, -432.09564f), new(293.58395f, -431.59433f), new(293.56439f, -431.55292f), new(295.53003f, -430.23953f), new(298.03906f, -428.03925f),
        new(298.4426f, -427.5791f), new(298.54401f, -427.58524f), new(298.83197f, -427.32526f), new(307.90356f, -432.66504f), new(308.67206f, -432.6619f),
        new(309.33972f, -432.28064f), new(311.04874f, -429.21558f), new(311.51904f, -429.18756f), new(312.25766f, -428.62396f), new(312.37646f, -427.70264f),
        new(312.16547f, -427.28128f), new(313.96555f, -424.26883f), new(313.96185f, -423.49982f), new(313.58038f, -422.83249f), new(304.4201f, -417.64624f),
        new(304.50131f, -417.26697f), new(304.44498f, -417.18176f), new(304.64417f, -416.59439f), new(305.29279f, -413.33005f), new(305.44748f, -410.97064f),
        new(305.49313f, -410.96689f), new(305.8476f, -410.57782f), new(306.01892f, -409.99994f)];
        ArenaBoundsCustom arena = new([new PolygonCustom(verticesOuter)], [new PolygonCustom(verticesInner)]);
        return (arena.Center, arena);
    }

    protected override void DrawEnemies(int pcSlot, Actor pc)
    {
        Arena.Actor(PrimaryActor);
        Arena.Actors(Enemies((uint)OID.SingularityFragment));
        Arena.Actors(Enemies((uint)OID.SingularityEcho));
        Arena.Actors(Enemies((uint)OID.SingularityRipple));
        Arena.Actors(Enemies((uint)OID.Ozmasphere));
        Arena.Actors(Enemies((uint)OID.Ozmashade));
    }
}
